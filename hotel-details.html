<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Details - Hotel Reservation SaaS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <nav id="navbar"></nav>
    
    <main class="py-5">
        <div class="container">
            <div id="hotelDetails"></div>
        </div>
    </main>

    <footer id="footer"></footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="utils.js"></script>
    <script src="auth.js"></script>
    <script src="booking.js"></script>
    <script src="main.js"></script>
    
    <script>
        function initHotelDetailsPage() {
            const params = utils.getUrlParams();
            const hotelId = parseInt(params.id);
            
            if (!hotelId) {
                window.location.href = '404.html';
                return;
            }
            
            const hotel = dummyData.hotels.find(h => h.id === hotelId);
            
            if (!hotel) {
                window.location.href = '404.html';
                return;
            }
            
            displayHotelDetails(hotel);
        }
        
        function displayHotelDetails(hotel) {
            const container = document.getElementById('hotelDetails');
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <img src="${hotel.image}" class="card-img-top" style="height: 400px; object-fit: cover;" alt="${hotel.name}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h1 class="card-title">${hotel.name}</h1>
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-map-marker-alt me-1"></i>${hotel.location}
                                        </p>
                                        <div class="rating mb-3">
                                            ${utils.generateStars(hotel.rating)}
                                            <span class="ms-2">${hotel.rating} out of 5</span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="price" style="font-size: 1.2rem;">${hotel.country ? utils.formatDualCurrency(hotel.price, hotel.country) : utils.formatCurrency(hotel.price)}</div>
                                        <small class="text-muted">per night</small>
                                    </div>
                                </div>
                                
                                <p class="card-text">${hotel.description}</p>
                                
                                <div class="mb-4">
                                    <h5>Amenities</h5>
                                    <div class="row">
                                        ${hotel.amenities.map(amenity => `
                                            <div class="col-md-6 mb-2">
                                                <i class="fas fa-check text-success me-2"></i>${amenity}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rooms Section -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Available Rooms</h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    ${hotel.rooms.map(room => `
                                        <div class="col-md-6 mb-4">
                                            <div class="card room-card">
                                                <div class="card-body">
                                                    <h5 class="card-title">${room.type}</h5>
                                                    <p class="card-text">
                                                        <i class="fas fa-users me-1"></i>Up to ${room.capacity} guests
                                                    </p>
                                                    <div class="mb-3">
                                                        ${room.amenities.map(amenity => `
                                                            <span class="badge bg-light text-dark me-1">${amenity}</span>
                                                        `).join('')}
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div class="price" style="font-size: 0.9rem;">${hotel.country ? utils.formatDualCurrency(room.price, hotel.country) : utils.formatCurrency(room.price)}/night</div>
                                                        <button class="btn btn-primary" onclick="selectRoom(${room.id}, '${room.type}', ${room.price})">
                                                            Select Room
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Booking Form -->
                    <div class="col-lg-4">
                        <div class="card booking-summary position-sticky" style="top: 100px;">
                            <div class="card-header">
                                <h4>Book Your Stay</h4>
                            </div>
                            <div class="card-body">
                                <form id="bookingForm" onsubmit="handleBooking(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Check-in Date</label>
                                        <input type="date" class="form-control" id="checkinDate" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Check-out Date</label>
                                        <input type="date" class="form-control" id="checkoutDate" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Guests</label>
                                        <select class="form-select" id="guests" required>
                                            <option value="">Select guests</option>
                                            <option value="1">1 Guest</option>
                                            <option value="2">2 Guests</option>
                                            <option value="3">3 Guests</option>
                                            <option value="4">4+ Guests</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Selected Room</label>
                                        <input type="text" class="form-control" id="selectedRoom" readonly placeholder="Select a room above">
                                        <input type="hidden" id="selectedRoomId">
                                        <input type="hidden" id="selectedRoomPrice">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>Total Price:</span>
                                            <strong id="totalPrice">$0</strong>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-calendar-check me-2"></i>Book Now
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Set minimum dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkinDate').min = today;
            document.getElementById('checkoutDate').min = today;
            
            // Update checkout min date and calculate total when dates change
            document.getElementById('checkinDate').addEventListener('change', function() {
                document.getElementById('checkoutDate').min = this.value;
                calculateTotal();
            });
            
            document.getElementById('checkoutDate').addEventListener('change', calculateTotal);
        }
        
        function selectRoom(roomId, roomType, roomPrice) {
            document.getElementById('selectedRoom').value = roomType;
            document.getElementById('selectedRoomId').value = roomId;
            document.getElementById('selectedRoomPrice').value = roomPrice;
            calculateTotal();
        }
        
        function calculateTotal() {
            const checkin = document.getElementById('checkinDate').value;
            const checkout = document.getElementById('checkoutDate').value;
            const roomPrice = parseFloat(document.getElementById('selectedRoomPrice').value) || 0;
            
            if (checkin && checkout && roomPrice) {
                const nights = Math.ceil((new Date(checkout) - new Date(checkin)) / (1000 * 60 * 60 * 24));
                const total = nights * roomPrice;
                document.getElementById('totalPrice').textContent = utils.formatCurrency(total);
            }
        }
        
        function handleBooking(event) {
            event.preventDefault();
            
            if (!auth.isLoggedIn()) {
                utils.showError('Please login to make a booking');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
            
            const formData = {
                hotelId: parseInt(utils.getUrlParams().id),
                roomId: parseInt(document.getElementById('selectedRoomId').value),
                checkinDate: document.getElementById('checkinDate').value,
                checkoutDate: document.getElementById('checkoutDate').value,
                guests: parseInt(document.getElementById('guests').value),
                totalPrice: parseFloat(document.getElementById('selectedRoomPrice').value) * 
                    Math.ceil((new Date(document.getElementById('checkoutDate').value) - 
                    new Date(document.getElementById('checkinDate').value)) / (1000 * 60 * 60 * 24))
            };
            
            // Validate form
            if (!formData.roomId) {
                utils.showError('Please select a room');
                return;
            }
            
            if (!formData.checkinDate || !formData.checkoutDate) {
                utils.showError('Please select check-in and check-out dates');
                return;
            }
            
            if (new Date(formData.checkinDate) >= new Date(formData.checkoutDate)) {
                utils.showError('Check-out date must be after check-in date');
                return;
            }
            
            // Store booking data and redirect to booking page
            localStorage.setItem('pendingBooking', JSON.stringify(formData));
            window.location.href = 'booking.html';
        }
    </script>
</body>
</html>