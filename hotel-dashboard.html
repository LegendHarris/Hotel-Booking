<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Dashboard - Hotel Reservation SaaS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="dashboard.css" rel="stylesheet">
</head>
<body>
    <nav id="navbar"></nav>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 dashboard-sidebar">
                <div class="p-3">
                    <ul class="dashboard-nav">
                        <li><a href="#" class="active" onclick="showHotelSection('overview')"><i class="fas fa-tachometer-alt"></i>Overview</a></li>
                        <li><a href="#" onclick="showHotelSection('hotels')"><i class="fas fa-hotel"></i>My Hotels</a></li>
                        <li><a href="#" onclick="showHotelSection('bookings')"><i class="fas fa-calendar-check"></i>Bookings</a></li>
                        <li><a href="#" onclick="showHotelSection('analytics')"><i class="fas fa-chart-bar"></i>Analytics</a></li>
                        <li><a href="#" onclick="showHotelSection('profile')"><i class="fas fa-user"></i>Profile</a></li>
                    </ul>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 dashboard-content">
                <div class="dashboard-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 id="sectionTitle">Hotel Dashboard</h2>
                        <button class="btn btn-primary" onclick="addNewHotel()">
                            <i class="fas fa-plus me-2"></i>Add Hotel
                        </button>
                    </div>
                </div>
                
                <div id="dashboardContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="utils.js"></script>
    <script src="auth.js"></script>
    <script src="dashboard.js"></script>
    <script src="main.js"></script>
    
    <script>
        // Hotel Dashboard Functions
        function showHotelSection(section) {
            // Update active nav
            document.querySelectorAll('.dashboard-nav a').forEach(a => a.classList.remove('active'));
            event?.target.classList.add('active');
            
            const content = document.getElementById('dashboardContent');
            const title = document.getElementById('sectionTitle');
            
            switch(section) {
                case 'overview':
                    title.textContent = 'Hotel Dashboard';
                    showHotelOverview(content);
                    break;
                case 'hotels':
                    title.textContent = 'My Hotels';
                    showMyHotels(content);
                    break;
                case 'bookings':
                    title.textContent = 'Hotel Bookings';
                    showHotelBookings(content);
                    break;
                case 'analytics':
                    title.textContent = 'Analytics';
                    showHotelAnalytics(content);
                    break;
                case 'profile':
                    title.textContent = 'Profile Settings';
                    showUserProfile(content);
                    break;
            }
        }
        
        function showHotelOverview(content) {
            const user = auth.getCurrentUser();
            const allBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const userHotels = dummyData.hotels.filter(h => h.ownerId === user.id || user.role === 'hotel_owner');
            const hotelBookings = allBookings.filter(b => userHotels.some(h => h.id === b.hotelId));
            
            const totalRevenue = hotelBookings.reduce((sum, b) => sum + b.totalPrice, 0);
            const totalBookings = hotelBookings.length;
            const occupancyRate = Math.round(Math.random() * 30 + 60); // Mock data
            
            content.innerHTML = `
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="card-body text-center">
                                <i class="fas fa-hotel stat-icon"></i>
                                <h3>${userHotels.length}</h3>
                                <p class="mb-0">My Hotels</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="card-body text-center">
                                <i class="fas fa-calendar-check stat-icon"></i>
                                <h3>${totalBookings}</h3>
                                <p class="mb-0">Total Bookings</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="card-body text-center">
                                <i class="fas fa-dollar-sign stat-icon"></i>
                                <h3>${utils.formatCurrency(totalRevenue)}</h3>
                                <p class="mb-0">Total Revenue</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="card-body text-center">
                                <i class="fas fa-percentage stat-icon"></i>
                                <h3>${occupancyRate}%</h3>
                                <p class="mb-0">Occupancy Rate</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5>Recent Bookings</h5>
                            </div>
                            <div class="card-body">
                                ${hotelBookings.length > 0 ? `
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Guest</th>
                                                    <th>Hotel</th>
                                                    <th>Dates</th>
                                                    <th>Status</th>
                                                    <th>Revenue</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${hotelBookings.slice(0, 5).map(booking => {
                                                    const hotel = dummyData.hotels.find(h => h.id === booking.hotelId);
                                                    return `
                                                        <tr>
                                                            <td>${booking.guestInfo?.firstName} ${booking.guestInfo?.lastName}</td>
                                                            <td>${hotel?.name}</td>
                                                            <td>${utils.formatDate(booking.checkinDate)} - ${utils.formatDate(booking.checkoutDate)}</td>
                                                            <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                                                            <td>${utils.formatCurrency(booking.totalPrice)}</td>
                                                        </tr>
                                                    `;
                                                }).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                ` : '<p class="text-muted">No bookings yet.</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" onclick="addNewHotel()">
                                        <i class="fas fa-plus me-2"></i>Add New Hotel
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="showHotelSection('bookings')">
                                        <i class="fas fa-list me-2"></i>View All Bookings
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="showHotelSection('analytics')">
                                        <i class="fas fa-chart-bar me-2"></i>View Analytics
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showMyHotels(content) {
            const user = auth.getCurrentUser();
            const userHotels = dummyData.hotels.filter(h => h.ownerId === user.id || user.role === 'hotel_owner');
            
            content.innerHTML = `
                <div class="dashboard-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>My Hotels</h5>
                        <button class="btn btn-primary" onclick="addNewHotel()">
                            <i class="fas fa-plus me-2"></i>Add Hotel
                        </button>
                    </div>
                    <div class="card-body">
                        ${userHotels.length > 0 ? `
                            <div class="row">
                                ${userHotels.map(hotel => `
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card">
                                            <img src="${hotel.image}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="${hotel.name}">
                                            <div class="card-body">
                                                <h5 class="card-title">${hotel.name}</h5>
                                                <p class="card-text">${hotel.location}</p>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <div class="rating">
                                                        ${utils.generateStars(hotel.rating)}
                                                        <span class="ms-1">${hotel.rating}</span>
                                                    </div>
                                                    <div class="price">${utils.formatCurrency(hotel.price)}/night</div>
                                                </div>
                                                <div class="btn-group w-100">
                                                    <button class="btn btn-outline-primary btn-sm" onclick="editHotel(${hotel.id})">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button class="btn btn-outline-info btn-sm" onclick="viewHotelBookings(${hotel.id})">
                                                        <i class="fas fa-calendar"></i> Bookings
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-5">
                                <i class="fas fa-hotel fa-3x text-muted mb-3"></i>
                                <h4>No hotels yet</h4>
                                <p class="text-muted">Add your first hotel to start receiving bookings!</p>
                                <button class="btn btn-primary" onclick="addNewHotel()">Add Hotel</button>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function showHotelBookings(content) {
            const user = auth.getCurrentUser();
            const userHotels = dummyData.hotels.filter(h => h.ownerId === user.id || user.role === 'hotel_owner');
            const allBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const hotelBookings = allBookings.filter(b => userHotels.some(h => h.id === b.hotelId));
            
            content.innerHTML = `
                <div class="dashboard-card">
                    <div class="card-header">
                        <h5>All Hotel Bookings</h5>
                    </div>
                    <div class="card-body">
                        ${hotelBookings.length > 0 ? `
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Confirmation #</th>
                                            <th>Guest</th>
                                            <th>Hotel</th>
                                            <th>Room</th>
                                            <th>Dates</th>
                                            <th>Guests</th>
                                            <th>Status</th>
                                            <th>Revenue</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${hotelBookings.map(booking => {
                                            const hotel = dummyData.hotels.find(h => h.id === booking.hotelId);
                                            const room = hotel?.rooms.find(r => r.id === booking.roomId);
                                            return `
                                                <tr>
                                                    <td><strong>${booking.confirmationNumber}</strong></td>
                                                    <td>${booking.guestInfo?.firstName} ${booking.guestInfo?.lastName}</td>
                                                    <td>${hotel?.name}</td>
                                                    <td>${room?.type}</td>
                                                    <td>${utils.formatDate(booking.checkinDate)} - ${utils.formatDate(booking.checkoutDate)}</td>
                                                    <td>${booking.guests}</td>
                                                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                                                    <td>${utils.formatCurrency(booking.totalPrice)}</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails(${booking.id})">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : `
                            <div class="text-center py-5">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <h4>No bookings yet</h4>
                                <p class="text-muted">Bookings will appear here once guests start booking your hotels.</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function showHotelAnalytics(content) {
            content.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5>Revenue Analytics</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5>Booking Trends</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="bookingChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function addNewHotel() {
            alert('Add New Hotel functionality would be implemented here');
        }
        
        function editHotel(hotelId) {
            alert(`Edit Hotel ${hotelId} functionality would be implemented here`);
        }
        
        function viewHotelBookings(hotelId) {
            alert(`View bookings for Hotel ${hotelId} functionality would be implemented here`);
        }
    </script>
</body>
</html>